<!DOCTYPE html>
<html lang="ru">
  <head>
    <title>Физические Пазлы - Soft8Soft</title>
    <meta charset="utf-8">
    <meta name="description" content="Использование пазлов для моделирования физического поведения."/>
    <base href="../../../" />
    <script src="page.js"></script>
    <link type="text/css" rel="stylesheet" href="page.css" />
  </head>
  <body><article>

    <h1>Физика</h1>

    <p>
      Эти пазлы используются для моделирования физического поведения объектов.
    </p>

    <img src="files/puzzles/puzzles-physics.jpg" style="max-width: 1000px">

    <h2>Содержание</h2>

    [contents]


    [anchor:physics_puzzles_reference]

    <h2>Перечень Физических Пазлов</h2>


    [anchor:create_physics_world]

    <h3>create physics world</h3>

    <p>
      Инициализирует физический движок, используя указанные параметры *gravity* и *frames-per-second*. Значение *gravity* по умолчанию 9.8 соответствует условиям на поверхности Земли. Нулевое значение означает отсутствие гравитации, как в космосе. Чем выше значение *fps*, тем выше качество симуляции в ущерб производительности.
    </p>

    <p>Флажок *soft body* активирует возможность симуляции мягкого тела.</p>

    <img src="files/puzzles/puzzles-physics-create-physics-world.jpg">

    <p>
      Под капотом, этот пазл также обеспечивает обнаружение столкновений и автоматическую синхронизацию с графикой.
    </p>


    <!-- COMPAT: < 3.5 -->
    <a href="#" id="create_physics_body"></a>

    [anchor:create_rigid_body]

    <h3>create rigid body</h3>

    <p>
      Создает физическое тело из указанного объекта типа  *dynamic*, *kinematic*, *static* или *ghost*. Присваивает форму столкновения и задает массу тела (действительно только для *dynamic* тел). Также работает для списка объектов, группы (или списка групп) или с пазлом <a href="manual/ru/puzzles/Selectors.html#all_objects">all objects</a>.
    </p>

    <img src="files/puzzles/puzzles-physics-create-physics-body.jpg">

    <p>Физические типы тела:</p>

    <ul>
      <li>
        *dynamic* - перемещаются с помощью физического движка, подвержены влиянию столкновений и сталкиваются с другими телами.
      </li>
      <li>
        *kinematic* - перемещаются с помощью анимации или действий пользователя. Динамические объекты будут отталкиваться, но влияние от динамических объектов отсутствует.
      </li>
      <li>
        *static* - не могут двигаться, но сталкиваются с другими телами.
      </li>
      <li>
        *ghost* - 
        аналогичен *kinematic*, но не производит никакой реакции на столкновение. Используйте его для <a href="manual/ru/puzzles/Physics.html#detect_collision">обнаружения столкновения</a> между телами (например, для реализации датчика приближения).
      </li>
    </ul>

    <p>Поддерживаемые формы жесткого тела:</p>

    <ul>
      <li>
        *box* - ограничение в форме куба.
      </li>
      <li>
        *sphere* - ограничение в форме сферы.
      </li>
      <li>
        *mesh* - форма меша.
      </li>
      <li>
        *capsule* - форма капсулы, вытянутая вдоль оси вверх-вниз.
      </li>
      <li>
        *cone* - конусообразная форма, вытянутая вдоль оси вверх-вниз.
      </li>
      <li>
        *cylinder* - цилиндрическая форма, вытянутая вдоль оси вверх-вниз.
      </li>
      <li>
        *empty* - пустая форма. Полезно для создания привязок ограничений и точек привязки мягкого тела.
      </li>
    </ul>

    <p>
      По соображениям производительности отдавайте предпочтение примитивным физическим формам (кубам, сферам, капсулам, конусам и цилиндрам), а не детальным мешам. Кроме того, *static* меши имеют гораздо лучшую производительность, чем *dynamic*, *kinematic* и *ghost*.
    </p>


    [anchor:create_soft_body]

    <h3>create soft body</h3>

    <p>
      Создает мягкое тело из указанного объекта с заданной общей *mass* и необязательными параметрами *pressure*. Также работает для списка объектов, группы (или списка групп) или с пазлом <a href="manual/ru/puzzles/Selectors.html#all_objects">all objects</a>.
    </p>

    <img src="files/puzzles/puzzles-physics-create-soft-body.jpg">

    <p>Поддерживаемые мягкие формы тела:</p>

    <ul>
      <li>
        *volume* - закрытый герметичный трехмерный объем.
      </li>
      <li>
        *rope* - линейный объект, который ведет себя как веревка.
      </li>
      <li>
        *patch* - многоугольная поверхность, например, ткань или текстильная заплатка.
      </li>
    </ul>

    <p class="note">
      Не забудьте активировать симуляцию мягких тел в <a href="manual/ru/puzzles/Physics.html#create_physics_world">physics world</a> перед созданием мягких тел.</p>


    [anchor:remove_physics_body]

    <h3>remove physics body</h3>

    <p>
      Удаляет физику с указанного объекта, уничтожая связанное с ним физическое тело. Также работает для списка объектов, группы (или списка групп) или с пазлом <a href="manual/ru/puzzles/Selectors.html#all_objects">all objects</a>.
    </p>

    <img src="files/puzzles/puzzles-physics-remove-physics-body.jpg">



    [anchor:apply_body_param]

    <h3>apply body param</h3>

    <p>
      Задает параметры для физического тела, связанного с указанным объектом.  Также работает для списка объектов, группы (или списка групп) или с пазлом <a href="manual/ru/puzzles/Selectors.html#all_objects">all objects</a>.
    </p>

    <img src="files/puzzles/puzzles-physics-apply-body-param.jpg">

    <p>Параметры:</p>

    <ul>
      <li>
        *angular damping* - коэффициент сопротивления, который замедлит вращающийся объект: 0 - демпфирование отсутствует, 1 - максимальное демпфирование. Входные значения ограничены диапазоном [0, 1].
      </li>
      <li>
        *angular factor* - установить степень свободного вращения для указанного тела. Например, установив компонент Z равным нулю, можно запретить вращение тела вокруг оси вверх-вниз (Blender, Max) или вперед-назад (Maya).
      </li>
      <li>
        *angular velocity* - установить вектор скорости вращения.
      </li>
      <li>
        *ccd motion threshold* - порог движения, используемый для моделирования физики непрерывного обнаружения столкновений (CCD). Укажите низкое значение, например <em>0.001</em>
      </li>
      <li>
        *ccd swept sphere radius* - радиус сферы, используемой для моделирования физики непрерывного обнаружения столкновений (CCD). Это значение должно соответствовать размеру сталкивающихся объектов. Например, для моделирования маленькой пули размером 0,01 м это значение можно смело установить равным 0,5.
      </li>
    </ul>

    <img src="files/puzzles/puzzles-physics-ccd-example.jpg">

    <ul>
      <li>
        *force* - толкать тело в заданном направлении.
      </li>
      <li>
        *friction* - коэффициент сопротивления относительному движению твердых тел, скользящих друг относительно друга.
      </li>
      <li>
        *gravity* - назначить гравитацию индивидуально для определенного тела.
      </li>
      <li>
        *impulse* - действует как *Linear Velocity*, но также учитывает массу тела (более тяжелые объекты приобретают меньшую скорость).
      </li>
    </ul>

    <img src="files/puzzles/puzzles-physics-apply-body-param-impulse.jpg" style="max-width: 793px">

    <ul>
      <li>
        *linear damping* - коэффициент сопротивления, который замедлит движущийся объект: 0 - нет демпфирования (например, свободное падение), 1 - максимальное демпфирование (например, объект падает без ускорения). Входные значения ограничены диапазоном [0, 1].
      </li>
      <li>
        *linear factor* - установить степени свободного перемещения для указанного тела. Например, установив компонент Z равным нулю, можно отключить движение тела вверх-вниз (Blender, Max) или вперед-назад (Maya).
      </li>
      <li>
        *linear velocity* - установить вектор скорости движения.
      </li>
      <li>
        *position* - установить положение тела (работает как пазл <a href="manual/ru/puzzles/Physics.html#snap_body">snap body</a>).
      </li>
      <li>
        *restitution* - коэффициент упругости: 0 - тело не упругое, как глина, 1 - тело ведет себя как сделанное из резины.
      </li>
      <li>
        *stiffness* - жесткость мягких тел, таких как объемы и канаты.
      </li>
      <li>
        *torque* - вращение тела в заданном направлении.
      </li>
      <li>
        *torque impulse* - действует как *Angular Velocity*, но учитывает массу тела (более тяжелые объекты приобретают меньшую скорость вращения).
      </li>
    </ul>

    <p class="note">
      Когда два тела сталкиваются, учитываются параметры трения и реституции обоих тел.
    </p>


    [anchor:get_body_param]

    <h3>get body param</h3>

    <p>
      Получает параметр из физического тела, связанного с указанным объектом.
    </p>

    <img src="files/puzzles/puzzles-physics-get-body-param.jpg">

    <p>Параметры:</p>

    <ul>
      <li>
        *angular damping* - коэффициент сопротивления, который будет замедлять вращающийся объект: 0 - демпфирование отсутствует, 1 - максимальное демпфирование.
      </li>
      <li>
        *angular factor* - степени свободного вращения для указанного тела (XYZ).
      </li>
      <li>
        *angular velocity* - вектор скорости вращения.
      </li>
      <li>
        *ccd motion threshold* - порог движения, используемый для моделирования физики непрерывного обнаружения столкновений (CCD).
      </li>
      <li>
        *ccd swept sphere radius* - радиус сферы, используемой для моделирования физики непрерывного обнаружения столкновений (CCD).
      </li>
      <li>
        *force* - вектор силы, приложенной к телу.
      </li>
      <li>
        *friction* - коэффициент сопротивления относительному движению твердых тел, скользящих друг относительно друга.
      </li>
      <li>
        *gravity* - вектор силы тяжести, приложенный к телу.
      </li>
      <li>
        *linear damping* - коэффициент сопротивления, который будет замедлять движущийся объект: 0 - отсутствие демпфирования (например, свободное падение), 1 - максимальное демпфирование (например, объект падает без ускорения).
      </li>
      <li>
        *linear factor* - степени свободного перемещения для указанного тела (XYZ).
      </li>
      <li>
        *linear velocity* - вектор скорости движения.
      </li>
      <li>
        *position* - положение тела XYZ.
      </li>
      <li>
        *restitution* - коэффициент упругости: 0 - тело не упругое, как глина, 1 - тело ведет себя как сделанное из резины.
      </li>
      <li>
        *stiffness* - жесткость мягких тел, например канатов и тел имеющих объем.
      </li>
      <li>
        *torque* - вектор крутящего момента, приложенного к телу.
      </li>
    </ul>



    [anchor:physics_body_params]

    <h3>physics body params</h3>

    <p class="red">
      Этот пазл теперь устарел. Вместо него используйте <a href="manual/ru/puzzles/Physics.html#apply_body_param">apply body param</a>. 
      </span>
    <p>
      Задает параметры для физического тела, связанного с указанным объектом. Также работает для списка объектов, группы (или списка групп) или с пазлом <a href="manual/ru/puzzles/Selectors.html#all_objects">all objects</a>.
    </p>

    <img src="files/puzzles/puzzles-physics-body-params.jpg">

    <p>Параметры:</p>

    <ul>
      <li>
        *friction* - коэффициент сопротивления относительному движению твердых тел, скользящих друг относительно друга.
      </li>
      <li>
        *linear damping* - коэффициент сопротивления, который замедлит движущийся объект: 0 - нет демпфирования (например, свободное падение), 1 - максимальное демпфирование (например, объект падает без ускорения). Входные значения ограничены диапазоном [0, 1].
      </li>
      <li>
        *angular damping* - коэффициент сопротивления, который замедлит вращающийся объект: 0 - демпфирование отсутствует, 1 - максимальное демпфирование. Входные значения ограничены диапазоном [0, 1].
      </li>
      <li>
        *restitution* - коэффициент упругости: 0 - тело не упругое, как глина, 1 - тело ведет себя как сделанное из резины.
      </li>
    </ul>

    <p>
      Когда два тела сталкиваются, учитываются параметры трения и реституции обоих тел.
    </p>

    <img src="files/puzzles/puzzles-physics-body-params-example.jpg" style="max-width: 903px">


    [anchor:apply_vector]

    <h3>apply vector</h3>

    <p class="red">
      Этот пазл теперь устарел. Вместо него используйте параметр 
       <a href="manual/ru/puzzles/Physics.html#apply_body_param">apply body</a>.</span>

    <p>
      Применяется *Force*, *Gravity*, *Linear Velocity*, *Angular Velocity*, *Impulse*, *Torque*, *Torque Impulse* или *Position* к физическому телу, связанному с указанным объектом, в указанном направлении в мировом пространстве. Также работает для списка объектов, группы (или списка групп) или с пазлом <a href="manual/ru/puzzles/Selectors.html#all_objects">all objects</a>.
    </p>

    <img src="files/puzzles/puzzles-physics-apply-vector.jpg">

    <p>
    Параметры:
    </p>

    <ul>
      <li>
        *force* - толкать тело в заданном направлении.
      </li>
      <li>
        *gravity* - назначить гравитацию индивидуально для определенного тела.
      </li>
      <li>
        *linear velocity* - установить скорость движения.
      </li>
      <li>
        *angular velocity* - установить скорость вращения.
      </li>
      <li>
        *impulse* -  действует как *Linear Velocity*, но также учитывает массу тела (более тяжелые объекты приобретают меньшую скорость).
      </li>
      <li>
        *torque* - вращает тело в заданном направлении.
      </li>
      <li>
        *torque impulse* - действует как *Angular Velocity*, но учитывает массу тела (более тяжелые объекты приобретают меньшую скорость вращения).
      </li>
      <li>
        *linear factor* - установить степени свободного позиционирования для указанного тела. Например, установив компонент Z равным нулю, можно отключить движение тела вверх-вниз (Blender, Max) или вперед-назад (Maya).
      </li>
      <li>
        *angular factor* - установить степени свободного вращения для указанного тела. Например, установив компонент Z равным нулю, можно запретить вращение тела вокруг оси вверх-вниз (Blender, Max) или вперед-назад (Maya).
      </li>
      <li>
        *position* - установить положение тела (работает как пазл <a href="manual/ru/puzzles/Physics.html#snap_body">snap body</a>).
      </li>
    </ul>


    [anchor:set_body_state]

    <h3>set body state</h3>

    <p>
      Изменение состояния физического тела, связанного с указанным объектом. Также работает для списка объектов, группы (или списка групп) или с пазлом <a href="manual/ru/puzzles/Selectors.html#all_objects">all objects</a>.
    </p>

    <img src="files/puzzles/puzzles-physics-set-body-state.jpg" class="centered" style="max-width: 764px">

    <p>Параметры:</p>

    <ul>
      <li>
        *activate* - активировать спящее физическое тело.
      </li>
      <li>
        *sleep* - усыпить физическое тело.
      </li>
      <li>
        *enable simulation* - включить симуляцию тела (по умолчанию включено).
      </li>
      <li>
        *disable simulation* - отключить симуляцию тела.
      </li>
      <li>
        *reset* - очистить все силы и скорости, приложенные к физическому телу.
      </li>
      <li>
        *enable contact response* - разрешить телу сталкиваться с другими телами (включено по умолчанию).
      </li>
      <li>
        *disable contact response* - отключить столкновение тел.
      </li>
      <li>
        *make dynamic* - придать телу динамику.
      </li>
      <li>
        *make kinematic* - придать телу кинематическую форму.
      </li>
      <li>
        *make static* - сделать тело статичным.
      </li>
      <li>
        *enable deactivation* - позволять телу переходить в спящее состояние после некоторого периода бездействия (включено по умолчанию).
      </li>
      <li>
        *disable deactivation* - отключить засыпание тела.
      </li>
    </ul>


    [anchor:on_simulation_tick]

    <h3>on simulation tick</h3>

    <p>
      Запуск пазлов, указанных в слоте *do", <em>непосредственно перед</em> или <em>сразу после</em> тика симуляции физики.
    </p>

    <img src="files/puzzles/puzzles-physics-on-simulation-tick.jpg" class="centered" style="max-width: 817px">

    <p>
      Тик симуляции физики соответствует значению FPS, указанному при создании <a href="manual/ru/puzzles/Physics.html#create_physics_world">physics world</a>, и не совпадает с кадром рендеринга. Поэтому мы рекомендуем применять силы/скорости/импульсы *до* тика симуляции и определять столкновения между телами *после* тика симуляции. Таким образом, вы сможете добиться более стабильной и реалистичной симуляции.
    </p>


    [anchor:snap_body]

    <h3>snap body</h3>

    <p>
      Перемещает физическое тело, связанное с указанным объектом, и сам объект в положение другого объекта, копируя его данные преобразования. Также копируется вращение. Не работает со списками, группами или пазлом "all objects".
    </p>

    <img src="files/puzzles/puzzles-physics-snap-body.jpg">

    <p>Работает аналогично пазлу *apply body param / position*.</p>


    [anchor:add_physics_constraint]

    <h3>add constraint to</h3>

    <p>
      Соединяет два физических тела ограничением заданного типа.
    </p>

    <img src="files/puzzles/puzzles-physics-add-physics-constraint.jpg">

    <p>Виды ограничений:</p>

    <ul>
      <li>
        *hinge* - соединить тела общей осью.
      </li>
      <li>
        *ball* - соедините тела с помощью шарообразного гнезда.
      </li>
      <li>
        *slider* - ограничить движение тел направлением вдоль оси X.
      </li>
      <li>
        *spring* - соединяют два тела с помощью пружинного шарнира.
      </li>
      <li>
        *fixed* - плотно соединяют два тела.
      </li>
    </ul>

    <img src="files/puzzles/puzzles-physics-add-physics-constraint-example.jpg">


    [anchor:remove_physics_constraint]

    <h3>remove constraint from</h3>

    <p>
      Удалите физическое ограничение.
    </p>

    <img src="files/puzzles/puzzles-physics-remove-physics-constraint.jpg">


    [anchor:soft_body_anchor]

    <h3>anchor soft body</h3>

    <p>
      Привязка мягкого тела к заданному жесткому телу в точке пространства, представленной заданным вектором.
    </p>

    <img src="files/puzzles/puzzles-physics-anchor-soft-body.jpg">


    <!-- COMPAT: something old -->
    <a href="#" id="detect_collision"></a>

    [anchor:detect_collisions]

    <h3>detect collisions and collision info</h3>

    <p>
      Определяет, есть ли столкновение в данный момент указанного тела с другим телом (или любым телом из списка или группы). Если столкновение произошло, срабатывают пазлы в слоте "if touching do", иначе - в слоте "if not touching do".
    </p>

    <p>
      Пазл "detect collisions" запускает любой из своих слотов обратного вызова каждый кадр рендеринга.
    </p>

    <img src="files/puzzles/puzzles-physics-detect-collisions.jpg">

    <p>
    Пазл *collision info* выводит <a href="manual/ru/puzzles/Dictionaries.html">словарь</a> со следующими полями:
    </p>

    <ul>
      <li>
        *objectA* - имя первого столкнувшегося тела.
      </li>
      <li>
        *objectB* - имя второго сталкивающегося тела.
      </li>
      <li>
        *distance* - расстояние между точками столкновений.
      </li>
      <li>
        *positionOnA* - XYZ координаты точки столкновения на первом объекте.
      </li>
      <li>
        *positionOnB* - XYZ координаты точки столкновения на втором объекте.
      </li>
      <li>
        *normalOnB* - XYZ компоненты вектора нормали в точке столкновения на втором объекте.
      </li>
    </ul>

    <img src="files/puzzles/puzzles-physics-detect-collisions-info.jpg">


    [anchor:extending_with_javascript]

    <h2>Расширение с помощью JavaScript</h2>

    <p class="note">Перед началом чтения, пожалуйста, ознакомьтесь с разделом <a href="manual/ru/introduction/Using-JavaScript.html">Использование JavaScript</a> данного руководства пользователя.</p>

    <p>Для создания физических пазловмы используем библиотеку JavaScript под названием Ammo.js. Эта библиотека представляет собой популярный физический движок Bullet, скомпилированный для использования в браузере.</p>

    <p>
      Чтобы познакомиться с Bullet, ознакомьтесь с руководством по <a href="https://github.com/bulletphysics/bullet3/blob/master/docs/Bullet_User_Manual.pdf" target="_blank">Bullet Physics SDK</a>, доступным на GitHub, а также с официальным справочником <a href="https://pybullet.org/Bullet/BulletFull/index.html" target="_blank">Bullet API Reference</a>.
    </p>

    <p>В Verge3D вы можете выполнять API Bullet/Ammo.js напрямую, используя пространство имен Ammo:</p>

    <code>
var myVector = new Ammo.btVector3(1.0, 0.0, 0.0);
console.log('My physics vector is:', myVector.x(), myVector.y(), myVector.z());
    </code>

    <p>Также вы можете получить доступ к следующим структурам данных, которые мы используем в пазлах:</p>

    <h3>World</h3>

    <p>
      В зависимости от инициализированного физического мира он может быть экземпляром класса <a href="https://pybullet.org/Bullet/BulletFull/classbtDiscreteDynamicsWorld.html">btDiscreteDynamicsWorld</a> или <a href="https://pybullet.org/Bullet/BulletFull/classbtSoftRigidDynamicsWorld.html" target="_blank">btSoftRigidDynamicsWorld</a>:
    </p>

    <code>
var gravity = v3d.puzzles.physics.world.getGravity();
console.log('World gravity:', gravity.y());
    </code>

    <h3>Physics Bodies</h3>

    <p>Физические тела хранятся как данные с ключевым значением внутри объекта <strong>v3d.puzzles.physics.bodies</strong>:</p>

    <code>
var body = v3d.puzzles.physics.bodies['Whirligig'];
console.log('Body mass:', 1.0 / body.getInvMass());
    </code>

    <p>
      Жесткие тела являются экземплярами класса <a href="https://pybullet.org/Bullet/BulletFull/classbtRigidBody.html" target="_blank">btRigidBody</a>, а мягкие тела - экземплярами класса <a href="https://pybullet.org/Bullet/BulletFull/classbtSoftBody.html" target="_blank">btSoftBody</a>. 
    
    <h3>Physics Constraints</h3>

    <p>Ограничения на пули/патроны хранятся в виде ключевых значений внутри двумерного объекта <strong>v3d.puzzles.physics.constraints</strong>:</p>

    <code>
var hingeConstraint = v3d.puzzles.physics.constraints['Suzanne']['Axis'];
hingeConstraint.enableAngularMotor(true, 10, 10);
    </code>

    <p>Эти имена представляют первое и второе тела ограничения соответственно.</p>

    <h3>Physics Sync List</h3>

    <p>Пазлы Verge3D используют так называемый список синхронизации для перемещения объектов, представленных физическими телами, в пространстве. Список синхронизации недоступен напрямую, поэтому для добавления/удаления тел в/из этого списка необходимо использовать следующие методы API.</p>

    <code>
// add obj / body to the sync list
// the type can be 'DYNAMIC', 'KINEMATIC', 'STATIC', 'GHOST', or 'SOFT_BODY'
v3d.puzzles.physics.addToSyncList(obj, body, 'DYNAMIC');

// remove obj / body from the sync list
v3d.puzzles.physics.removeFromSyncList(obj, body);
    </code>



    <h2>Проблемы с Пазлами?</h2>

    <p>Обратитесь за помощью на наш <a href="https://www.soft8soft.com/forums/" target="_blank">форум</a>!</p>

  </article></body>
</html>
