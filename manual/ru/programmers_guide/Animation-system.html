<!DOCTYPE html>
<html lang="ru">
  <head>
    <title>Анимация Verge3D - Soft8Soft</title>
    <meta charset="utf-8" />
    <meta name="description" content="Как анимировать сцену Verge3D с помощью JavaScript."/>
    <base href="../../../" />
    <script src="page.js"></script>
    <link type="text/css" rel="stylesheet" href="page.css" />
  </head>
  <body><article>
    <h1>Система Анимации</h1>

    <h2>Обзор</h2>

    <p class="desc">
      В системе анимации Verge3D вы можете анимировать различные свойства ваших моделей: кости модели [page:SkinnedMesh skinned and rigged model], [page:Geometry.morphTargets morph targets], различные свойства материалов (цвет, прозрачность, булевы функции), видимость и трансформации. Анимированные свойства могут быть затухающими, перекрестными и деформированными. Вес и временные шкалы различных одновременных анимаций на одном и том же объекте, а также на разных объектах могут быть изменены независимо друг от друга. Различные анимации на одном и том же и на разных объектах могут быть синхронизированы.<br /><br />

      Чтобы достичь всего этого в одной однородной системе, анимационная система Verge3D [ссылка:https://github.com/mrdoob/three.js/issues/6881 полностью изменилась в 2015 году] (следите за актуальностью информации!), и теперь она имеет архитектуру, схожую с Unity/Unreal Engine 4. На этой странице представлен краткий обзор основных компонентов системы и того, как они работают вместе.

    </p>

    <h3>Анимационные Клипы</h3>

    <p class="desc">

      Если вы успешно импортировали анимированный 3D-объект (неважно, есть ли у него кости или morph targets или и то, и другое) - например, экспортировали его из Blender с помощью Blender exporter и загрузили в сцену Verge3D с помощью [page:GLTFLoader], одним из свойств геометрии загруженного меша должен быть массив с именем "animations", содержащий [page:AnimationClip AnimationClips] для этой модели (см. список возможных загрузчиков ниже)..<br /><br />

      Каждый *AnimationClip* обычно содержит данные для определенного действия объекта. Например, если меш является персонажем, может быть один AnimationClip для ходьбы, второй для прыжка, третий для уклонения в сторону и так далее.

    </p>

    <h3>Треки Ключевых Кадров</h3>

    <p class="desc">

      Внутри такого *AnimationClip* данные для каждого анимированного свойства хранятся в отдельной [page:KeyframeTrack]. Предположим, что объект персонажа имеет [page:Skeleton skeleton], одна дорожка ключевых кадров может хранить данные об изменении положения кости нижней части руки со временем, другая дорожка - данные об изменении вращения той же кости, третья данные о положении, вращении или масштабировании другой кости, и так далее. Следует понимать, что AnimationClip может состоять из множества таких дорожек.<br /><br />

      Предполагается, что модель имеет [page:Geometry.morphTargets morph targets] (например, один morph target показывает дружелюбное лицо, а другой - сердитое), каждая дорожка содержит информацию о том, как меняется влияние [page:Mesh.morphTargetInfluences] определенной morph target во время исполнения клипа.

    </p>

    <h3>Микшер Анимации</h3>

    <p class="desc">

      Сохраненные данные составляют лишь основу для анимации - фактическое воспроизведение контролируется [page:AnimationMixer]. Вы можете представить его не только как плеер для анимаций, но и как имитацию аппаратуры, подобной настоящему микшерному пульту, который может управлять несколькими анимациями одновременно, смешивая и объединяя их.

    </p>

    <h3>Анимационные Действия</h3>

    <p class="desc">

      Сам *AnimationMixer* имеет очень мало (общих) свойств и методов, поскольку им можно управлять с помощью [page:AnimationAction AnimationAction]. Настроив *AnimationAction*, вы можете определить, когда определенный *AnimationClip* должен быть воспроизведен или остановлен на одном из микшеров, будет ли и как часто клип должен повторяться, должен ли он выполняться с затуханием или масштабированием времени, и некоторые дополнительные вещи, такие как кроссфейдинг или синхронизация.

    </p>

    <h3>Анимация Группы Объектов</h3>

    <p class="desc">

      Если вы хотите, чтобы группа объектов получала общую анимацию, вы можете использовать элемент
      [page:AnimationObjectGroup].

    </p>

    <h3>Поддерживаемые Форматы и Загрузчики</h3>

    <p class="desc">
      Обратите внимание, что не все форматы моделей включают анимацию (OBJ, например, не включает), и что только некоторые загрузчики Verge3D поддерживают последовательности [page:AnimationClip AnimationClip]. Некоторые из них поддерживают этот тип анимации:
    </p>

      <ul>
        <li>[page:JSONLoader v3d.JSONLoader]</li>
        <li>[page:ObjectLoader v3d.ObjectLoader]</li>
        <li>v3d.BVHLoader</li>
        <li>v3d.ColladaLoader</li>
        <li>v3d.FBXLoader</li>
        <li>[page:GLTFLoader v3d.GLTFLoader]</li>
        <li>v3d.MMDLoader</li>
        <li>v3d.SEA3DLoader</li>
      </ul>

    <p class="desc">
      Обратите внимание, что 3ds max и Maya в настоящее время не могут экспортировать несколько анимаций (имеется в виду анимации, которые не находятся на одной временной шкале) непосредственно в один файл.
    </p>

    <h2>Пример</h2>

    <code>
    var mesh;

    // Create an AnimationMixer, and get the list of AnimationClip instances
    var mixer = new v3d.AnimationMixer(mesh);
    var clips = mesh.animations;

    // Update the mixer on each frame
    function update () {
      mixer.update(deltaSeconds);
    }

    // Play a specific animation
    var clip = v3d.AnimationClip.findByName(clips, 'dance');
    var action = mixer.clipAction(clip);
    action.play();

    // Play all animations
    clips.forEach(function(clip) {
      mixer.clipAction(clip).play();
    });
    </code>

  </article></body>
</html>
